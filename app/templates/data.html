{% extends "base.html" %}
{% block content %}
<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for routes" style="background-image: url('{{ url_for('static', filename='searchicon.png') }}');">
<table id="myTable" class="table table-striped table-bordered table-sm" cellspacing="0"
  width="100%">
  <thead class="thead-dark">
    <tr>
      <th scope="col">#ID</th>
      <th scope="col" data-filter-control="input">ROUTE</th>
      <th scope="col">IP</th>
      <th scope="col">USER AGENT</th>
      <th scope="col">REFERRER</th>
        <th scope="col">CLICKTIME</th>
      <th scope="col">ACTIONS</th>

    </tr>
  </thead>
  <tbody>
  {% for row in data %}
    <tr>
      <td id="id{{row.id}}">{{row.id}}</td>
      <td > {{row.url}}</td>
      <td >{{row.ip}}</td>
      <td >{{row.ua}}</td>
      <td >{{row.referrer}}</td>
      <td><script>document.write(moment.utc("{{row.created}}").local().format('YYYY-MM-DD HH:mm:ss'));</script></td>
      <td><button type="button" class="btn btn-danger"
              onclick="delete_data_row(document.getElementById('id{{row.id}}').textContent);setTimeout('window.location.reload(true)', 1000);">DELETE</button></td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<button type="button" class="btn btn-danger btn-lg btn-block"
  onclick="delete_data_allrow();setTimeout('window.location.reload(true)', 1000);">DELETE ALL</button>
<script>
  function delete_data_row(id){
    $.post(
    "{{adminrouteapi_data_delete_row}}",
    {
        'id': id
    },
    onAjaxSuccess
     );
      function onAjaxSuccess(data){
     alert(data);
     }
    }

    function delete_data_allrow(){
    $.post(
    "{{adminrouteapi_data_delete_all}}",
    {

    },
    onAjaxSuccess
     );
      function onAjaxSuccess(data){
     alert(data);
     }
    }

</script>
<script>
function myFunction() {
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[1];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}
</script>
{% endblock %}